#!/usr/bin/env sh

./rebuild $@ || exit $?

DBNAME=`psql -qtc 'SELECT current_database()' $@` || exit $?
TEST_SCHEMAS=`psql -qtf test_schemas.sql $@` || exit $?

for schema in $TEST_SCHEMAS; do
  PGOPTIONS="-c search_path=tap" pg_prove --trap --state hot,all,save --failures --runtests --match '^[^_]' --jobs 9 --schema $schema -d $@
done

# vi: expandtab sw=2 ts=2
